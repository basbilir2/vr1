<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Persistent AR Object</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/2.2.1/aframe/build/aframe-ar.min.js"></script>
    <script>
      AFRAME.registerComponent("markerhandler", {
        init: function () {
          const marker = this.el; // Marker referansı
          const model = document.querySelector("#model"); // Model referansı
          let isModelLocked = false; // Model sabitlenmiş mi?

          marker.addEventListener("markerFound", () => {
            if (!isModelLocked) {
              // Marker algılandığında, dünya pozisyonunu kaydet
              const position = marker.object3D.getWorldPosition(new THREE.Vector3());
              const rotation = marker.object3D.getWorldQuaternion(new THREE.Quaternion());

              // Modeli dünya koordinatlarında sabitle
              model.object3D.position.copy(position);
              model.object3D.quaternion.copy(rotation);

              // Marker ile bağlantısını kaldır
              marker.object3D.remove(model.object3D);
              document.querySelector("a-scene").object3D.add(model.object3D);

              isModelLocked = true; // Model artık sabitlendi
              model.setAttribute("visible", "true");
            }
          });
        },
      });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      <!-- Marker -->
      <a-marker
        preset="custom"
        type="pattern"
        url="https://basbilir2.github.io/vr1/pattern-marker.patt"
        markerhandler
      >
        <a-entity id="placeholder" position="0 0 0" visible="false"></a-entity>
      </a-marker>

      <!-- 3D Model -->
      <a-entity
        id="model"
        gltf-model="https://basbilir2.github.io/vr1/cow.glb"
        scale="0.3 0.3 0.3"
        visible="false"
      ></a-entity>

      <!-- Kamera -->
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
